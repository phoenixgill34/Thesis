\chapter{Implementation}
\label{chapter5}

\section{Overview}
This chapter outlines the implementation of heterogeneous test-bed for cooperative spectrum sensing using software-defined radios N210, and RTL-SDR and we also describe the simulation test-bed for performance analysis of LTE-R communication system in a tunnel environment. We start with heterogeneous cooperative spectrum sensing where we first describe the experimental setup which is implemented using soft and hard fusion schemes. The sensor nodes which consists of three RTL-SDRs and one USRP N210 are placed in a controlled indoor laboratory environment around 8-10 meters apart. The signal source is being simulated by another USRP N210 which is transmitting a DQPSK signal at 450 MHz. The post-processing is done on a Fusion Center which makes the decision based on global test statistic using both soft and hard decision schemes. The performance of both the schemes are evaluated in a real fading scenario on a hardware test-bed. 

We then discuss our LTE-R test-bed implementation in MATLAB and compare the performance for QPSK, 16QAM and 64QAM modulation schemes in a tunnel environment. First we show the results of K-factor variation in a tunnel environment for a high speed train in a tunnel. Using the K-factor we then implement our channel model which also takes into effect the high Doppler shift due to mobility of the train. The bit-error rate curves are generated for the LTE-R modulation schemes for the proposed channel model for high speed train in a tunnel. Finally, we show a time-varying BER curve for high speed train moving with the velocity $v$ at discrete timesteps.


\section{Experimental Setup for Heterogeneous CSS}

The measurements are performed using software-defined radios (SDRs) and the post processing is conducted on desktop computers. The desktop computer consists of i7 Intel processor with eight cores and 3.41 GHz clock cycle running Ubuntu 16.04. The sensor node network is implemented using RTL-SDR dongles and Ettus Research USRP N210 on GNU Radio Software platform. The measurements are analyzed in MATLAB and measurement plots are generated. Figure~\ref{expsetup} consists of three RTL-SDRs and two USRP N210s. One USRP N210 in the middle acts as a primary user and other SDRs are sensor nodes. All the SDRs were placed in the lab atleast 5-6  meters away from the primary user.

\begin{sidewaysfigure}
\centering
	\includegraphics[width=\textwidth]{images/Gill/figs/setup.eps} 
\caption{Experimental Test-Bed For Cooperative Sensing in Heterogeneous Network. Sensors 1, 2 and 4 are RTL-SDR units, sensor 3 is USRP N210 and TX is another USRP N210 unit which is used as a signal source for this work.}
\label{expsetup}
\end{sidewaysfigure}

These sensor nodes collect the spectral data, normalize it and then transmit it to the FC for the detection. For soft data fusion, the data is quantized in the local sensor nodes before it is transmitted to FC due to the limited bandwidth of the overhead channel. The delays caused by different sensor nodes is ignored, as it would require extra computational complexity and it is out of the scope of this thesis. The USRP N210 transmits a DQPSK modulated signal with 4 samples per symbol with the alpha factor of the root raised cosine filter set to 0.35. The transmitter gain and amplitude are varied to get different SNR values for each node. The sensor nodes collect the data for the equivalent of 300,000 energy samples, and each measurement is conducted three times to eliminate any irregularities. The noise variance $\sigma_n^2$ for each SU is estimated by running each sensor node without any transmission at 450 MHz. The flow-graph is executed multiple times to get a better estimate of noise variance. Once the data is received from all the sensor nodes, Probability of detection is calculated for different received SNR values for all the sensor nodes. To properly evaluate the performance of each of the cooperative spectrum sensing techniques, the average $P_d$ is calculated for each scheme. 

All four sensor nodes have different sampling rates to truly model the heterogeneous environment. The USRP N210 which is also used as a $4^{th}$ sensor node has a very low noise floor compared to the three other and hence can detect a signal with very low SNR. This is a challenging factor for data fusion when the nodes have different operating parameters and FC has to make optimal decisions by combining this varying data. And due to their spatial diversity the node closest to the transmitter will have different SNR compared to the other nodes. All these factors impact the data combining at FC. The GNURadio flow-graph for the sensor nodes is shown in the Figure~\ref{receiver}. The same flow-graph is used for all sensor nodes with different operating parameters. For USRP N210 node, we replaced the RTL-SDR source with UHD:USRP Source gnuradio block. The central frequency is kept at 450 MHz and the operating parameters of each sensor node is provided in the table. The values of the transmitter amplitude and gain are varied to get the different sets of SNR values which are used for computing $P_d$ values for each node. The plots are generated in MATLAB by using the data files from gnuradio platform.

\subsection{Sensor Node and Signal Source Setup}
To evaluate the performance of the cooperative spectrum sensing, the USRP N210 is used as a transmitter where its gain and amplitude are varied. Figure~\ref{transmitter} shows the flow-graph used for the transmitter. The flowgraph starts with the random source block which generates the random data between 0 and three, and pass it to the differential phase shift keying (DPSK) modulator block. The DPSK block modulates the signal with differential quadrature phase shift keying (DQPSK) scheme, apply root raise cosine filter with excess bandwidth value of 0.35 and pass it to multiply const block. It is used to control the SNR value and finally the data is dumped into USRP N210 sink which transmits the data over the air where other sensor nodes can estimate the signal presence using soft and hard decision schemes.

\begin{figure}[ht!]
	\centering
	\includegraphics[width=\textwidth,keepaspectratio]{images/Gill/figs/transmitter.eps}
    \caption{GNU Radio Flowgraph For Transmitter Running on USRP N210.} 
\label{transmitter}      
\end{figure}

\begin{figure}[ht!]
	\centering
	\includegraphics[width=\textwidth,keepaspectratio]{images/Gill/figs/normalizedenergy.eps}
    \caption{GNURadio Flowgraph For USRP and RTL-SDR sensor nodes.} 
\label{receiver}      
\end{figure}

\begin{table}[!ht]
\caption{Operating Characteristics of Sensor Nodes}
\centering
\vspace{-5pt}
\begin{tabular}{c c c c c}
\toprule
Nodes      & $F_s$     & Gain  & FFT Size &  Bin Size \\ \hline
RTL-SDR-1  & 1.1 Msps  & 10 dB & 512      & 2.148 KHz \\ \hline
RTL-SDR-2  & 1.8 Msps  & 10 dB & 512      & 3.515 KHz\\ \hline
RTL-SDR-3  & 2.4 Msps  & 10 dB & 512      & 4.687 KHz\\ \hline
USRP N210  & 7.2 Msps  & 10 dB & 512     &  14.062 KHz\\ 
\bottomrule
\end{tabular}
\vspace{-5pt}
\label{table1}
\end{table}

The sensor nodes are placed inside the laboratory and are connected to distributed system. Figure~\ref{receiver} shows the flowgraph running on the receiver, for flowgraph running on USRP we use UHD:USRP source instead of RTL-SDR source. The frequency around 450 MHz is sweeped in regular intervals and the continuous data stream is passed to FFT block which does the forward FFT operation with blackmann harris window. The data is first converted into parallel stream of the FFT size using stream to vector gnu radio block. We complex to magnitude block converts the complex values into float and take their magnitude. The bin selector block is used to select the bin where the narrow-band signal is being transmitted by the transmitter. We then take the moving average of the values, normalize them and then store it to the file sink. The normalized energy values are collected for each sensor at different SNR values and then post processing is performed in MATLAB. The operating parameters of each sensor node is provided in the table~\ref{table1}.

\section{Hard-Data Fusion Scheme}
\label{hardfusion}
Cooperative spectrum sensing using hard-data fusion is a proven method for improving the detection performance. In this scheme, all sensor nodes sense the signal source individually and send their sensing decision in the form of 1-bit binary data. For hard data fusion, the noise $w_q$ can be neglected since the sensor nodes can just transmit their decision statistic in an efficient way, where the floating values are not required. For example, the SUs can just transmit ''1'' and ''0'' depending on whether the primary user is present or absent. Furthermore, in the Fusion Center the decision can be made by using the OR, AND, or majority rule algorithms. For the AND decision rule, the FC performs the logical AND operation for all the local decisions and conducts the detection. Similarly, for the OR rule, the logical OR operation is used to decide whether the signal is present or not. Finally, the majority rule conducts majority vote and decides based on it~\cite{ghasemi2005collaborative,duan2010performance}. The $P_d$ for AND, OR and Majority Rule for R=4 sensor nodes is given by~\cite{inphtn15}:
\begin{equation}
P_{d,AND} = (P_d)^4\nonumber\\
\vspace{-15pt}
\end{equation}
\begin{equation}
\label{hard}
~~~~~~~P_{d,OR} = 1-(1-P_d)^4
\vspace{-15pt}
\end{equation}
\begin{equation}
P_{d,MJR} = 6P_{davg}^2(1-P_{davg})^2+4P_{davg}^3(1-P_{davg})+P_{davg}^4\nonumber
\end{equation}
where $P_{davg}$ is the average probability of detection of the sensor units. Similarly, we can calculate the $P_{fa}$ for all three schemes by replacing $P_{davg}$ by $P_{faavg}$ in Eq~(\ref{hard}).

\begin{figure}[ht!]
	\centering
	\includegraphics[width=\textwidth,height=10cm,keepaspectratio]{images/Gill/figs/hardfusion.eps}
\caption{Flowchart showing AND, OR and Majority Rule Fusion schemes.} 
\label{hard}      
\end{figure}

\section{Soft-Data Fusion Scheme}

In soft-data fusion based cooperative spectrum sensing, information from different CR users is combined to make a decision on the presence or absence of the primary user.
In~\ref{hardfusion} we discuss the conventional hard combination where each CR user feedbacks one-bit message regarding whether observed energy is above a certain threshold . In this section, we discuss soft combination of the local test statistic of each sensor nodes and how it is combined to make the decision in the FC. Since in the soft combination accurate energy values from different CR users are utilized to make a decision, this scheme is more accurate and complex to implement. In this thesis, we discuss two popular soft decision fusion schemes: Maximum Normalized Energy (MNE) scheme and Equal Gain Combining (EGC) scheme.

\subsection{Maximum Normalized Energy Scheme}
The local test statistic in each sensor node is computed and then transmitted to FC after quantization. In this thesis, we are using four sensor nodes equipped with different sensing abilities such as the sampling rates and noise floor. Therefore, the global test statistic $G$ can be modeled by:
\begin{equation}
\label{eq:8}
G_{MNE} = \max\{\beta_r\},
\end{equation}
The $P_{fa}$ and $P_d$ values for the MNE-CS is given by:~\cite{ref:12},
\begin{equation}
\label{eq:9}
P_{fa} = 1-\prod_{r=1}^R\Bigg(1-Q\Bigg(\dfrac{\tau-1}{\sqrt{\dfrac{1}{M_r}+\sigma_{q,r}}}\Bigg)\Bigg),
\end{equation}
\begin{equation}
\label{eq:10}
~~~~~~P_d = 1-\prod_{r=1}^R\Bigg(1-Q\Bigg(\dfrac{\tau-1-\gamma_r}{\sqrt{\dfrac{1+2\gamma_r}{M_r}+\sigma_{q,r}}}\Bigg)\Bigg).
\end{equation}
where $\tau$ is the global threshold for MNE, $M_r$ is the number of samples for $r^{th}$ sensor node, and $\sigma_{q,r}$ is the noise variance for the received local test statistic.The algorithm for MNE-CS is illustrated by the flowchart in Figure~\ref{mnescheme}.


\begin{figure}[ht!]
	\centering
	\includegraphics[width=\textwidth,height=10cm,keepaspectratio]{images/Gill/figs/mnescheme.eps}
\caption{Flowchart describing Maximum Normalized Energy Scheme in detail.} 
\label{mnescheme}      
\end{figure}


\subsection{Equal Gain Combining Scheme}

For EGC, the global decision statistic is the mean of the $\beta$ values for all the sensor nodes. It has been shown in \cite{inhtn12} that the EGC scheme performs better than the MNE scheme in a noisy channel. The EGC scheme can be modeled by:
\begin{equation}
	\label{eq:11}
	 G_{EGC} = \dfrac{1}{M}\sum_{r=1}^{M}{\beta_r},
\end{equation}
where $G_{EGC}$ is global test statistic of EGC scheme. The $P_{fa}$ and $P_d$ values for the EGC-CS scheme are given by:
\begin{equation}
\label{eq:12}
P_{fa} = Q\Bigg(\dfrac{\tau-1}{\sqrt{\dfrac{1}{R^2}\sum_{r=1}^{R}\bigg(\dfrac{1}{M_r}+\sigma_{q,r}^2\bigg)}}\Bigg),
\end{equation}

\begin{equation}
\label{eq:13}
~~~~~~P_d = Q\Bigg(\dfrac{\tau-\dfrac{1}{R}\sum_{r=1}^R(1+\gamma_r)}{\sqrt{\dfrac{1}{R^2}\sum_{r=1}^{R}\bigg(\dfrac{1+2\gamma_r}{M_r}+\sigma_{q,r}^2\bigg)}}\Bigg).
\end{equation}
The algorithm for EGC-CS is also illustrated by the flowchart in Figure~\ref{inphtn15}.

\begin{figure}[ht!]
	\centering
	\includegraphics[width=\textwidth,height=10cm,keepaspectratio]{images/Gill/figs/egcscheme.eps}
\caption{Flowchart describing Equal Gain Combining Scheme in detail.} 
\label{egcscheme}      
\end{figure}

\section{LTE-R Testbed in Matlab}

We have implemented the simulation testbed in MATLAB, consisting of a transmitter, a channel and a receiver. The K-factor values for the channel model are obtained from Eq.(\ref{kfactor}) and are used to generate a time-series BER curve for different modulation schemes used in LTE-R. The values used for the electrical material properties for tunnel walls~\cite{lter17} and its
specifications are given in Table~\ref{tablelter}. The relative permittivity for the tunnel walls is taken as $\varepsilon_r = 5$ and $\sigma$ is set to 0.1. The simulation is conducted for velocity of $v (Km/h) = $ 300, 400 and 500 Km/h. Since the frequency band allocation for LTE-R will most probably be from 2--6 GHz, hence the $f_c$ values chose are 2, 3 and 5 GHz. The height of the receiver is assumed to be around the length of the train and height of tunnel is chosen as the size of the leaky coaxial cable.

\begin{table*}[t!]
\centering
\caption{Tunnel and Tx/Rx Characteristics}
\begin{tabular}{c  c  c }
   & Dimensions & Simulation Parameters\\\hline
Tunnel & Width = 8.6 m, Height = 7.3 m & $\varepsilon_r = 5$, $\sigma = 0.1~\textrm{Sm}^{-1}$\\\hline
Leaky Feeder Cable (Tx) & Height = 6.1 m & $f_c$ (GHz) = 2, 3, 5\\\hline
Train (Rx) & Height = 4.2 m &  v (km/h) = 300, 400, 500\\
\hline
\end{tabular}
\label{tablelter}
\end{table*}

\begin{figure}[!ht]
\label{finalblock}
\centering
\includegraphics[width=\textwidth,height=8cm,keepaspectratio]{images/Gill/lte_figs/finalblock.eps} 
\caption{Block diagram of a communication system through a HST channel using QPSK, 16-QAM and 64-QAM.}
\end{figure}

Figure~\ref{finalblock} shows the block diagram of the simulation test-bed used for the performance analysis of LTE-R. The random source block generate the symbol between 0 and M-1, where M = 4,16,64 for QPSK, 16QAM and 64QAM respectively. The data is then modulated with specific modulation type and then pass through the proposed HST channel model. The additive white gaussian noise is added after applying the channel coefficients to the signal data. We then demodulate the data packets and pass it to the ber calculator object which then computes the bit-error rate. The simulations are run for SNR values ranging from 0--20 dB and plots are generated for all three modulation schemes.

\section{Summary}
This chapter outlined and examined the topics of jamming and anti-jamming techniques, and provided a foundation in communication system theory and advanced equalizer design.  Secondly it setup an understanding of Software-Defined Radio, the power of such an architecture, and examples of implementations and existing software for future designs.  Next, this thesis will consider a new anti-jamming technique and design an implementation of such a system.  After the implementation is investigated, the result of specific experiments on such an implementation will be analyzed.\\
